apiVersion: v1
kind: ServiceAccount
metadata:
  name: f5gc-udr-sa
  namespace: f5gc
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: f5gc-udr-rbac
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: f5gc-udr-sa
  namespace: f5gc
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: f5gc-udr-config
  namespace: f5gc
data:
  udrcfg.conf: |
    info:
      version: 1.0.0
      description: UDR initial local configuration

    configuration:
      sbi:
        scheme: http
        registerIPv4: f5gc-udr
        bindingIPv4: 0.0.0.0
        port: 29504
      mongodb:
        name: free5gc
        url: mongodb://f5gc-mongodb:27017
      nrfUri: http://f5gc-nrf:29510
  free5GC.conf: |
    db_uri: mongodb://f5gc-mongodb:27017/free5gc

    #all logging levels
    #panic
    #fatal
    #error
    #warn
    #debug
    #debug
    #trace
    logger:
    # network function
      AMF:
        debugLevel: debug
        ReportCaller: true
      SMF:
        debugLevel: debug
        ReportCaller: true
      UDR:
        debugLevel: debug
        ReportCaller: true
      UDM:
        debugLevel: debug
        ReportCaller: true
      NRF:
        debugLevel: debug
        ReportCaller: true
      PCF:
        debugLevel: debug
        ReportCaller: true
      AUSF:
        debugLevel: debug
        ReportCaller: true
      N3IWF:
        debugLevel: debug
        ReportCaller: true
    # library
      NAS:
        debugLevel: debug
        ReportCaller: true
      FSM:
        debugLevel: debug
        ReportCaller: true
      NGAP:
        debugLevel: debug
        ReportCaller: true
      NamfComm:
        debugLevel: debug
        ReportCaller: true
      NamfEventExposure:
        debugLevel: debug
        ReportCaller: true
      NsmfPDUSession:
        debugLevel: debug
        ReportCaller: true
      NudrDataRepository:
        debugLevel: debug
        ReportCaller: true
      OpenApi:
        debugLevel: debug
        ReportCaller: true
      Aper:
        debugLevel: debug
        ReportCaller: true
      CommonConsumerTest:
        debugLevel: debug
        ReportCaller: true
    # webui
      WEBUI:
        debugLevel: debug
        ReportCaller: true
---
apiVersion: v1
kind: Secret
metadata:
  name: f5gc-udr-tls-secret
  namespace: f5gc
type: Opaque
data:
  udr.key: |
    LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBeUwydk
    xPNHZyUXUyZ0dNc25qSitFQ2tCMFRodUE0Q21oRWt0bWhaeDd1UUNyRG9YCkpHK3FOZ0E1
    WHg1Zy9pTThvdEhCMTRYNENRQjBnaGpEU2x3NnovTStlQ0w2ZlFhcWpGa2hyWGorTFBlcU
    5uV1UKSUNEUnh6WWt5eG5aNzk1eXJzMkhhUU1uSTA1M0hSdXVYNHFzc0QzMU1Ucmxzb0NY
    WVFKclhQOXlFWjlDYUtNTgpRdkRlMVpFaEh4OG9kYjBkdlNUcFhyZHQ4Z3Y1MlJvN2MzUH
    QraWdrdUNPQ1JuT1dpRVV4Y0dJcE5WYWQ1bk1GCkJNZzZkOElMbW9aQ2JvZjZEQW5lb0RB
    c1VZa2g1QnZLd1VrUXVSTFdyUm5VMHpndzZRUWZnUWlZaXowRHpRdDgKSnFMT3ErZjhYc0
    1RTS9kRm5zREVoYTFpU05mMTRtY1pRZDdOL3dJREFRQUJBb0lCQUF0QnI4QUtQendwNnZy
    NgpGTGR1UjJscWswS0RNcEFadDd5MVNjeFpNOXhjaHRYWGtCS24vRmg0M0w2N3VsNmw1VE
    dRSjVtSlZxWlNrelgwClk0Y1k4dWRVVVkxMUVLelFJZUlxNFZ1VDdGVGpNblZKVkp3VW13
    N2J0Mlo0TmFOZ3l2ZUlhTzUza2N0R0RDSGkKdW4xN0RrSDN4M2NTUVcwb0R0VU95S3gzV3
    BNb1RLaEFJbm5sSTlsY1M0clROUDJ5SklVZ1pGZDEzM0VobkZ1WApTYWJ6R2tBQ1IyN1F5
    ZjY2a1JlUlJNS3BxS24wc2JwVFEvQ3lGWkNpQ1RlS0Z6RXNXTUtsU3lRMjBIZzNOVGlsCl
    hHK2NSU2RhanNNN2x4WEFRSmthL3FzNHUvTmlnc3QxcWRuMzZyWHQvdlFxL3NtTjA2Mmpr
    SnIweC9VeVNqS2MKNExKOFQxa0NnWUVBNXh3OGsrd3ZQYzRJODNHMEx4QklFcXJiWXYrNE
    M0WmwrWVdJUEVuTEF6cklwanVYNUx6SApFTnQ3bUVMQ3VmWjhUOWRPeGJMeWc5TWhOUVRJ
    Q0tEQ2N0ZXV1NEtQZWdyRU1CWXhCenl4cngxOFVqM1VmaFlxClpEWCtORnNacWwrM3dxck
    41UXpGZmltWWt6OCt6em9zM094MWd0WEpqRXVrdVdOYjRIVWpvVk1DZ1lFQTNsd28KYlJP
    aGlKMFU1ZXRjNm0wY1NCTWhGdXp6RDd2a2wyZVdYazAwRlY4aXlpRnFNUnhvZWhvZzIveW
    ZhV3ZDSjZ6YQpIRnBtdWlWUlhlVGE4Y0hTZlZBM1dNbkNwSTBsODBjRDFlajkzZ3ZtVnVS
    R1hKRHZpdnd4d0JWVGdkY3pMcjdmCnFzVlFSbzd3Wnhkd2l3NDZWaENZczR0dVUyRGR2SG
    ZkRmQvMDd5VUNnWUVBbUI5TCtJb2tabWd5R0J3bDREeTEKVkNSR21CbCtpWWVEcEFTek1n
    dllwMTJRS1d0Y2hlR0VucUg1N3JVeSs3azFCbERRdHUwZEdJeG1kVUdhY2FOdgptcXhCaF
    lkZzdaSWNwUkpXWDA4aUhnUW9pdkhMNXRxc09KNFpuMWkvd2hlVEczM1dYUWhWRHNCT2Y4
    M0hpQnZnCjMrSjlUd3R0eVAwWmhqWFNpaUpRdTZVQ2dZRUFzQ3ROc0JXMGpqcjl1cWQ5cH
    hHcExZVlNXd3FDREQ0dC9yS0kKVk5CUDZuckVZbWFVN3JIMktIOFk5NUd2YnVOOElOajJ1
    UzM2WTVKN1k2dVV0Nk43TStOZzVreDdsTWxyZnRJTgp2T1ZxZFFqeWhuYzNNOUYwcDZYbG
    VLeXN5NXNISndyOHhCeXQzQ2tWV0dnZXQxMGZaTjZqVE9TMEZRVVN5R1lpCjJGam1ncTBD
    Z1lCaWFlWThyQUJRMUNwdGhlN0JlcUE2TnlZK3Q4Vnc0d3V1RDgwRzQ5eVp1aUh6NXBORU
    NCRGEKRG85UDFSTlUwMDhieWFLQ3BoSUpGcE9lQUdleUFsZzNzUnpqOVJNa1kzZlR1T1Uy
    Y3E2SUN4eDMzWTNUQ2lCZQpDcUQrMWp4eXFURldOSVAxeStMaUJHRmpvNFh6WVhQOEtIYl
    Z3dGR0aDdCRFNuVHh1dkZhdFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  udr.pem: |
    LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZRENDQWtpZ0F3SUJBZ0lKQUlZZn
    JRVExUUFppTUEwR0NTcUdTSWIzRFFFQkN3VUFNRVV4Q3pBSkJnTlYKQkFZVEFrRlZNUk13
    RVFZRFZRUUlEQXBUYjIxbExWTjBZWFJsTVNFd0h3WURWUVFLREJoSmJuUmxjbTVsZENCWA
    phV1JuYVhSeklGQjBlU0JNZEdRd0hoY05NVGt3TnpJeU1UTTFNRFU1V2hjTk1qa3dOekU1
    TVRNMU1EVTVXakJGCk1Rc3dDUVlEVlFRR0V3SkJWVEVUTUJFR0ExVUVDQXdLVTI5dFpTMV
    RkR0YwWlRFaE1COEdBMVVFQ2d3WVNXNTAKWlhKdVpYUWdWMmxrWjJsMGN5QlFkSGtnVEhS
    a01JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQgpDZ0tDQVFFQXlMMnZMTz
    R2clF1MmdHTXNuakorRUNrQjBUaHVBNENtaEVrdG1oWng3dVFDckRvWEpHK3FOZ0E1Clh4
    NWcvaU04b3RIQjE0WDRDUUIwZ2hqRFNsdzZ6L00rZUNMNmZRYXFqRmtoclhqK0xQZXFObl
    dVSUNEUnh6WWsKeXhuWjc5NXlyczJIYVFNbkkwNTNIUnV1WDRxc3NEMzFNVHJsc29DWFlR
    SnJYUDl5RVo5Q2FLTU5RdkRlMVpFaApIeDhvZGIwZHZTVHBYcmR0OGd2NTJSbzdjM1B0K2
    lna3VDT0NSbk9XaUVVeGNHSXBOVmFkNW5NRkJNZzZkOElMCm1vWkNib2Y2REFuZW9EQXNV
    WWtoNUJ2S3dVa1F1UkxXclJuVTB6Z3c2UVFmZ1FpWWl6MER6UXQ4SnFMT3ErZjgKWHNNUU
    0vZEZuc0RFaGExaVNOZjE0bWNaUWQ3Ti93SURBUUFCbzFNd1VUQWRCZ05WSFE0RUZnUVVF
    L2pIQlZWeQpQbEhleTJsSXY4Q1M5c0lYSFM0d0h3WURWUjBqQkJnd0ZvQVVFL2pIQlZWeV
    BsSGV5MmxJdjhDUzlzSVhIUzR3CkR3WURWUjBUQVFIL0JBVXdBd0VCL3pBTkJna3Foa2lH
    OXcwQkFRc0ZBQU9DQVFFQVp1c2RsRWJYaERkbXdaRE4KZ0JsTzdvVlY2a3VXVVIzdjJ1ZH
    pGWk40RXpQMnFuZjJKUmtpTU9uSW45bCtOT2NRVmFyR3pJNSthWnM0R2JMcgpmR2k2UU9s
    dTV6UTlyV1I0a24yclNlSUhoUk1zWUh0bC93K0RtM1YvY1YxdTBBTmNJZm8xc1ZsMUZUU0
    VNd0lsClhyL09aT3RVZ1d3dVJ3NGh3bDJPYU1EckszWjJqVEN0SE9OSW5SVkt1eXlTcVln
    UjZaTUpGS2lLU2ZZWXhTbDkKK2kxYllDRzV0VlIxalplNXh2ckY4Z0FBQlUrYjI0TUpIR0
    pmY1h2U244WjVKeGdxUkRYL2NmS2kxZzI3d2V3SgpwNVBSdjY1OXNTYUhyazV5VVRDYXI4
    czl6ZE5uYUFrcXRCbXJ1MEp4Qmt6RU1OMm1Db3Vid3h5cTFRVkFJN3UyCnlFSWM3QT09Ci
    0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: f5gc-udr
  name: f5gc-udr
  namespace: f5gc
spec:
  ports:
  - name: f5gc-udr
    port: 29504
    protocol: TCP
    targetPort: 29504
  selector:
    app: f5gc-udr
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: f5gc-udr
  namespace: f5gc
  labels:
    app: f5gc-udr
  annotations:
    free5gc.org/nsi-ids: '[ 
      { "id": "4e6db941-47d6-4fce-9c71-f7eb35a75d03" },
    ]'
    free5gc.org/nssi-id: 27394d25-dbf5-428e-8fc3-f5b2add67115
spec:
  replicas: 1
  selector:
    matchLabels:
      app: f5gc-udr
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: f5gc-udr
    spec:
      containers:
      - name: f5gc-udr
        image: monandkey/free5gc-udr:3.0.4
        imagePullPolicy: IfNotPresent
        command: [./udr]
        ports:
        - containerPort: 29504
          name: f5gc-udr
          protocol: TCP
        securityContext:
          privileged: false
        volumeMounts:
        - mountPath: /free5gc/config
          name: f5gc-udr-config
        - mountPath: /free5gc/support/TLS
          name: f5gc-udr-cert
      - name: tcpdump
        image: corfr/tcpdump
        imagePullPolicy: IfNotPresent
        command:
        - /bin/sleep
        - infinity
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext:
        runAsGroup: 0
        runAsUser: 0
      serviceAccountName: f5gc-udr-sa
      terminationGracePeriodSeconds: 30
      volumes:
      - name: f5gc-udr-cert
        secret:
          secretName: f5gc-udr-tls-secret
      - configMap:
          name: f5gc-udr-config
        name: f5gc-udr-config
